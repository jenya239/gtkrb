# –û—Ç—á–µ—Ç –æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ: –í—ã–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –¥–µ—Ä–µ–≤–∞ —Ñ–∞–π–ª–æ–≤

## üéØ –¶–µ–ª—å
–í—ã–¥–µ–ª–∏—Ç—å –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã —Å –¥–µ—Ä–µ–≤–æ–º –ø–∞–ø–æ–∫ –∏ —Ñ–∞–π–ª–æ–≤, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏, —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–ª–æ–π –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ –æ—Ç GTK.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ù–æ–≤—ã–π —Å–ª–æ–π –ª–æ–≥–∏–∫–∏ (lib/core/)
- **`FileTreeItem`** - —ç–ª–µ–º–µ–Ω—Ç –¥–µ—Ä–µ–≤–∞ (—Ñ–∞–π–ª/–ø–∞–ø–∫–∞)
- **`FileTreeState`** - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ (—Ä–∞—Å–∫—Ä—ã—Ç—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã, –≤—ã–±—Ä–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç)
- **`FileTreeManager`** - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, –Ω–∞–≤–∏–≥–∞—Ü–∏—è, –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞)

### –ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è GTK (lib/ui/widgets/)
- **`FileTreeAdapter`** - –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º GTK –∫–æ–¥–æ–º

## üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏—è

### –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
```
FileExplorer -> FileTreeDataSource -> –ø—Ä—è–º–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
                   ‚Üì
              TreeView -> VirtualTreeRenderer (—Å –ª–æ–≥–∏–∫–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏)
```

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
```
FileExplorer -> FileTreeAdapter -> FileTreeManager -> FileTreeItem/FileTreeState
                   ‚Üì                     ‚Üì
              TreeView -> VirtualTreeRenderer (–±–µ–∑ –ª–æ–≥–∏–∫–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏)
```

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
- **–ü—Ä–æ–±–ª–µ–º–∞**: `stack.pop` –≤ `flatten_tree` –Ω–∞—Ä—É—à–∞–ª –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
- **–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ–ø–∏—Å–∞–Ω –∞–ª–≥–æ—Ä–∏—Ç–º —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `queue.shift`, –≤—ã–Ω–µ—Å–µ–Ω –≤ `FileTreeManager`

### 2. –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –ø–∞–ø–æ–∫
- **–ü—Ä–æ–±–ª–µ–º–∞**: `can_expand?` –≤ `VirtualTreeRenderer` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É
- **–†–µ—à–µ–Ω–∏–µ**: –õ–æ–≥–∏–∫–∞ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ `FileTreeItem.can_expand?`

### 3. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ `toggle_expand` –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
- **–†–µ—à–µ–Ω–∏–µ**: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ `FileTreeManager`

## üìä –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

### –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (`test/file_tree_manager_test.rb`)
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ Root items
- ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ (–ø–∞–ø–∫–∏, –ø–æ—Ç–æ–º —Ñ–∞–π–ª—ã, –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É)
- ‚úÖ Children
- ‚úÖ Expansion/Collapse
- ‚úÖ Flat tree
- ‚úÖ Directory navigation
- ‚úÖ Item types

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (`test/integration_test.rb`)
- ‚úÖ FileTreeAdapter
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å TreeView

### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å (`test/simple_test.rb`)
- ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –õ–æ–≥–∏–∫–∞ –¥–µ—Ä–µ–≤–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞
- –¢–µ—Å—Ç—ã –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç GTK
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–µ—Ä–µ–≤–∞
- –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –∫–æ–¥

### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π GTK –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è

## üìÅ –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
lib/
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ file_tree_item.rb      # –≠–ª–µ–º–µ–Ω—Ç –¥–µ—Ä–µ–≤–∞
‚îÇ   ‚îú‚îÄ‚îÄ file_tree_state.rb     # –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–µ—Ä–µ–≤–∞
‚îÇ   ‚îî‚îÄ‚îÄ file_tree_manager.rb   # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
‚îî‚îÄ‚îÄ ui/
    ‚îî‚îÄ‚îÄ widgets/
        ‚îî‚îÄ‚îÄ file_tree_adapter.rb  # –ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è GTK

test/
‚îú‚îÄ‚îÄ file_tree_manager_test.rb  # –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ integration_test.rb        # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ run_all_tests.rb          # –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
```

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω:
- ‚úÖ –õ–æ–≥–∏–∫–∞ –¥–µ—Ä–µ–≤–∞ –≤—ã–¥–µ–ª–µ–Ω–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–ª–æ–π
- ‚úÖ 100% –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏
- ‚úÖ –í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –∫–æ–¥ 