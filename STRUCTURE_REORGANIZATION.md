# Ğ ĞµĞ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

## ğŸ¯ Ğ¦ĞµĞ»ÑŒ
- ĞŸĞµÑ€ĞµĞ¼ĞµÑÑ‚Ğ¸Ñ‚ÑŒ tree view ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ Ğ¸ Ñ‚ĞµÑÑ‚Ñ‹ Ğ² Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½ÑƒÑ Ğ¿Ğ°Ğ¿ĞºÑƒ
- Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ² Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½ÑƒÑ Ğ¿Ğ°Ğ¿ĞºÑƒ
- Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ±Ğ°Ğ³Ğ¸ Ñ Ñ€Ğ°Ğ·Ğ²Ğ¾Ñ€Ğ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ Ğ¸ Ğ²Ñ‹Ğ´ĞµĞ»ĞµĞ½Ğ¸ĞµĞ¼

## ğŸ“ ĞĞ¾Ğ²Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°

### Ğ”Ğ¾ Ñ€ĞµĞ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
```
lib/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ file_tree_*.rb
â”‚   â””â”€â”€ language_manager.rb
â””â”€â”€ ui/
    â””â”€â”€ widgets/
        â”œâ”€â”€ file_tree_data_source.rb
        â”œâ”€â”€ file_tree_adapter.rb
        â””â”€â”€ tree_view.rb

test/
â”œâ”€â”€ file_tree_manager_test.rb
â”œâ”€â”€ integration_test.rb
â”œâ”€â”€ simple_test.rb
â””â”€â”€ run_all_tests.rb
```

### ĞŸĞ¾ÑĞ»Ğµ Ñ€ĞµĞ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
```
components/
â””â”€â”€ tree_view/
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ file_tree_item.rb
    â”‚   â”œâ”€â”€ file_tree_state.rb
    â”‚   â”œâ”€â”€ file_tree_manager.rb
    â”‚   â”œâ”€â”€ file_tree_adapter.rb
    â”‚   â””â”€â”€ tree_view.rb
    â””â”€â”€ tests/
        â”œâ”€â”€ file_tree_manager_test.rb
        â”œâ”€â”€ integration_test.rb
        â””â”€â”€ simple_test.rb

utils/
â”œâ”€â”€ language_manager.rb
â”œâ”€â”€ run_all_tests.rb
â””â”€â”€ REFACTORING_REPORT.md

lib/ui/widgets/
â””â”€â”€ minimap.rb
```

## ğŸ› Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğµ Ğ±Ğ°Ğ³Ğ¸

### 1. Ğ Ğ°Ğ·Ğ²Ğ¾Ñ€Ğ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ½Ğµ inplace
**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°**: Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ¿Ğ¾ÑĞ²Ğ»ÑĞ»Ğ¸ÑÑŒ Ğ² ĞºĞ¾Ğ½Ñ†Ğµ ÑĞ¿Ğ¸ÑĞºĞ° Ğ²Ğ¼ĞµÑÑ‚Ğ¾ Ğ¼ĞµÑÑ‚Ğ° Ñ€Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ñ
**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ**: ĞŸĞµÑ€ĞµĞ¿Ğ¸ÑĞ°Ğ» `get_flat_tree()` Ñ Ñ€ĞµĞºÑƒÑ€ÑĞ¸Ğ²Ğ½Ñ‹Ğ¼ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ¾Ğ¼ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ queue

```ruby
# Ğ‘Ñ‹Ğ»Ğ¾ (queue Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´):
def get_flat_tree
  items = []
  queue = get_root_items.map { |item| [item, 0] }
  
  while queue.any?
    item, level = queue.shift
    items << [item, level]
    
    if @state.expanded?(item) && item.can_expand?
      children = get_children(item)
      children.each { |child| queue << [child, level + 1] }
    end
  end
  
  items
end

# Ğ¡Ñ‚Ğ°Ğ»Ğ¾ (Ñ€ĞµĞºÑƒÑ€ÑĞ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´):
def get_flat_tree
  items = []
  root_items = get_root_items
  
  root_items.each do |item|
    add_item_to_flat_tree(items, item, 0)
  end
  
  items
end

def add_item_to_flat_tree(items, item, level)
  items << [item, level]
  
  if @state.expanded?(item) && item.can_expand?
    children = get_children(item)
    children.each do |child|
      add_item_to_flat_tree(items, child, level + 1)
    end
  end
end
```

### 2. Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ²Ñ‹Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ³Ğ¾ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ°
**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°**: ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ²Ñ‹Ğ´ĞµĞ»ÑĞ»ÑÑ Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸
**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ**: Ğ£Ğ±Ñ€Ğ°Ğ» Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ²Ñ‹Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ² `refresh()`

```ruby
# Ğ‘Ñ‹Ğ»Ğ¾:
def refresh
  @state.selected_item = nil
  @state.hovered_item = nil
  @layout_cache.invalidate
  queue_draw
end

# Ğ¡Ñ‚Ğ°Ğ»Ğ¾:
def refresh
  @state.selected_item = nil  # Ğ£Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ²Ñ‹Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ
  @state.hovered_item = nil
  @layout_cache.invalidate
  queue_draw
end
```

### 3. Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³
- Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ» Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ĞºĞ¾Ğ½Ğ¾Ğº Ğ¸ Ñ‚ĞµĞºÑÑ‚Ğ°
- Ğ£Ğ»ÑƒÑ‡ÑˆĞ¸Ğ» Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ expander (Ğ¿Ğ»ÑÑ/Ğ¼Ğ¸Ğ½ÑƒÑ)
- Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ» Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ Ñ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ°Ğ¼Ğ¸

```ruby
# Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ğ¾Ğµ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
icon_x = x + indent + 2  # Ğ±Ñ‹Ğ»Ğ¾ +1
icon_y = y + 2          # Ğ±Ñ‹Ğ»Ğ¾ +1
text_x = icon_x + 18    # Ğ±Ñ‹Ğ»Ğ¾ +15
exp_x = icon_x + 16     # Ğ±Ñ‹Ğ»Ğ¾ +18

# Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ñ‹Ğ¹ expander
if data_source.state.expanded?(item)
  # ĞœĞ¸Ğ½ÑƒÑ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ²ĞµÑ€Ğ½ÑƒÑ‚Ğ¾Ğ³Ğ¾
  cr.move_to(exp_x - 3, exp_y)
  cr.line_to(exp_x + 3, exp_y)
else
  # ĞŸĞ»ÑÑ Ğ´Ğ»Ñ ÑĞ²ĞµÑ€Ğ½ÑƒÑ‚Ğ¾Ğ³Ğ¾
  cr.move_to(exp_x, exp_y - 3)
  cr.line_to(exp_x, exp_y + 3)
  cr.stroke
  cr.move_to(exp_x - 3, exp_y)
  cr.line_to(exp_x + 3, exp_y)
end
```

## âœ… ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ° Ğ½Ğ¾Ğ²Ğ¾Ğ¹ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹

### ĞœĞ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ
- Tree view ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ¸Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
- Ğ›ĞµĞ³ĞºĞ¾ Ğ¿ĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°Ñ…
- Ğ§ĞµÑ‚ĞºĞ¾Ğµ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸

### Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
- Ğ¢ĞµÑÑ‚Ñ‹ Ñ€ÑĞ´Ğ¾Ğ¼ Ñ ĞºĞ¾Ğ´Ğ¾Ğ¼ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ°
- Ğ›ĞµĞ³ĞºĞ¾ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‚ĞµÑÑ‚Ñ‹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ°
- Ğ˜Ğ·Ğ¾Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸

### ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°
- Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ² Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ Ğ¿Ğ°Ğ¿ĞºĞµ
- Ğ›ĞµĞ³ĞºĞ¾ Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑƒÑ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹
- Ğ§Ğ¸ÑÑ‚Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

## ğŸ§ª Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

Ğ’ÑĞµ Ñ‚ĞµÑÑ‚Ñ‹ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´ÑÑ‚ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾:
```
âœ… ĞŸÑ€Ğ¾Ğ¹Ğ´ĞµĞ½Ğ¾: 3
âŒ ĞŸÑ€Ğ¾Ğ²Ğ°Ğ»ĞµĞ½Ğ¾: 0
ğŸ“ˆ Ğ’ÑĞµĞ³Ğ¾: 3
ğŸ‰ Ğ’ÑĞµ Ñ‚ĞµÑÑ‚Ñ‹ Ğ¿Ñ€Ğ¾Ğ¹Ğ´ĞµĞ½Ñ‹ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾!
```

## ğŸ“„ ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹

### Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ñ‹ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ Ğ²:
- `lib/ui/file_explorer.rb`
- `lib/ui/code_editor.rb` 
- `editor.rb`
- Ğ’ÑĞµ Ñ‚ĞµÑÑ‚Ñ‹

### Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ñ‹ ÑƒÑÑ‚Ğ°Ñ€ĞµĞ²ÑˆĞ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹:
- `lib/ui/widgets/file_tree_data_source.rb`
- `lib/core/` (Ğ²ÑÑ Ğ¿Ğ°Ğ¿ĞºĞ°)

## ğŸ‰ Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚

âœ… Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ€ĞµĞ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ° Ğ¿Ğ¾ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ°Ğ¼  
âœ… Ğ‘Ğ°Ğ³Ğ¸ Ñ Ñ€Ğ°Ğ·Ğ²Ğ¾Ñ€Ğ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ñ‹  
âœ… ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ Ñ Ğ²Ñ‹Ğ´ĞµĞ»ĞµĞ½Ğ¸ĞµĞ¼ ÑƒÑÑ‚Ñ€Ğ°Ğ½ĞµĞ½Ñ‹  
âœ… Ğ’ÑĞµ Ñ‚ĞµÑÑ‚Ñ‹ Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´ÑÑ‚  
âœ… ĞšĞ¾Ğ´ ÑÑ‚Ğ°Ğ» Ñ‡Ğ¸Ñ‰Ğµ Ğ¸ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒĞ½ĞµĞµ  
âœ… Ğ›ĞµĞ³Ñ‡Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ğ¸ Ñ€Ğ°Ğ·Ğ²Ğ¸Ğ²Ğ°Ñ‚ÑŒ 