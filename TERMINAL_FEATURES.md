# üñ•Ô∏è Terminal Features

## ‚ú® –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞

### 1. **–ö–Ω–æ–ø–∫–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ ‚åò**

–í –∫–∞–∂–¥–æ–π –ø–∞–Ω–µ–ª–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ `‚åò` —Ä—è–¥–æ–º —Å –¥—Ä—É–≥–∏–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏.

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: –ü–∞–Ω–µ–ª—å –∑–∞–≥–æ–ª–æ–≤–∫–∞ ‚Üí –ö–Ω–æ–ø–∫–∏ ‚Üí `‚åò`

### 2. **–£–º–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–±–æ—á–µ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞**

–¢–µ—Ä–º–∏–Ω–∞–ª –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–µ–º –∫–∞—Ç–∞–ª–æ–≥–µ:

1. **–ö–∞—Ç–∞–ª–æ–≥ —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞** (–µ—Å–ª–∏ —Ñ–∞–π–ª –æ—Ç–∫—Ä—ã—Ç)
2. **–ö–∞—Ç–∞–ª–æ–≥ –∏–∑ –¥–µ—Ä–µ–≤–∞ —Ñ–∞–π–ª–æ–≤** (–µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –æ—Ç–∫—Ä—ã—Ç)
3. **–¢–µ–∫—É—â–∏–π –∫–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–µ–∫—Ç–∞** (fallback)

### 3. **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤**

- **‚åò** - –æ—Ç–∫—Ä—ã—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª (in-place)
- **üìù** - –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä—É

### 4. **VTE3 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**

- **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞**: `vte3` gem
- **API**: `spawn_sync` —Å —á–∏—Å–ª–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- **Shell**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ ($SHELL –∏–ª–∏ /bin/bash)
- **Scrollback**: 1000 —Å—Ç—Ä–æ–∫ –∏—Å—Ç–æ—Ä–∏–∏
- **Fallback**: –ü—Ä–∏ –æ—à–∏–±–∫–µ spawn –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `feed_child`

### 5. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º**

#### **–ü—Ä–æ–±–ª–µ–º–∞ 1**: –û—à–∏–±–∫–∞ `spawn_async` —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

**–†–µ—à–µ–Ω–∏–µ**: 
```ruby
@terminal.spawn_sync(
  0,                          # flags (—á–∏—Å–ª–æ –≤–º–µ—Å—Ç–æ :default)
  working_dir,                # —Ä–∞–±–æ—á–∏–π –∫–∞—Ç–∞–ª–æ–≥
  [ENV['SHELL'] || '/bin/bash'], # –∫–æ–º–∞–Ω–¥–∞
  nil,                        # environment
  0                           # spawn flags (—á–∏—Å–ª–æ –≤–º–µ—Å—Ç–æ :default)
)
```

#### **–ü—Ä–æ–±–ª–µ–º–∞ 2**: –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–∏ –ø–∞–Ω–µ–ª–µ–π –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏—Å—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏ —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä

**–†–µ—à–µ–Ω–∏—è**:
1. **–Ø–≤–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞**: –î–æ–±–∞–≤–ª–µ–Ω `@current_editor.widget.show_all` –≤ `setup_ui`
2. **–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º**: –¢–µ—Ä–º–∏–Ω–∞–ª –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏, –Ω–æ —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è
3. **–ú–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è**: `ensure_correct_display_state()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
4. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ**: –¢–µ—Ä–º–∏–Ω–∞–ª –∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

#### **–ü—Ä–æ–±–ª–µ–º–∞ 3**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –ø–∞–Ω–µ–ª–µ–π

**–†–µ—à–µ–Ω–∏–µ**: –ù–æ–≤—ã–µ –ø–∞–Ω–µ–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞—é—Ç `ensure_correct_display_state()` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏

#### **–ü—Ä–æ–±–ª–µ–º–∞ 4**: –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –ø—Ä–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–∏ –ø–∞–Ω–µ–ª–µ–π

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–∏ –ø–∞–Ω–µ–ª–µ–π `show_all` –≤ SplitContainer –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ –≤–∏–¥–∂–µ—Ç—ã, –≤–∫–ª—é—á–∞—è —Å–∫—Ä—ã—Ç—ã–µ

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ—Å–ª–µ `show_all` –≤ `SplitContainer`
```ruby
# –í split_pane –ø–æ—Å–ª–µ show_all
GLib::Idle.add do
  if existing_pane.respond_to?(:ensure_correct_display_state)
    existing_pane.ensure_correct_display_state
  end
  if new_pane.respond_to?(:ensure_correct_display_state)
    new_pane.ensure_correct_display_state
  end
  false
end
```

#### **–ü—Ä–æ–±–ª–µ–º–∞ 5**: Segfault (core dumped) –≤ –≤—ã–ø–∞–¥–∞—é—â–µ–º —Å–ø–∏—Å–∫–µ –∏—Å—Ç–æ—Ä–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞**: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ signal handlers, –º–æ–¥–∞–ª—å–Ω—ã–µ popup –æ–∫–Ω–∞ –∏ —Ç–∞–π–º–µ—Ä—ã –≤—ã–∑—ã–≤–∞–ª–∏ segmentation fault

**–†–µ—à–µ–Ω–∏–µ**: –£–ø—Ä–æ—â–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
```ruby
# –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è
safe_destroy = proc do
  unless popup_destroyed
    popup_destroyed = true
    popup.destroy
  end
end

# –¢–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
event_box.signal_connect('button-press-event') do |widget, event|
  if event.button == 1 && !popup_destroyed
    pane.load_file(file_path)
    safe_destroy.call
  end
  true
end
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- –£–¥–∞–ª–µ–Ω–∞ –º–æ–¥–∞–ª—å–Ω–æ—Å—Ç—å popup –æ–∫–Ω–∞
- –£–±—Ä–∞–Ω—ã –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ signal handlers
- –£–¥–∞–ª–µ–Ω GLib::Timeout.add 
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω–æ–≥–æ destroy
- –£–ø—Ä–æ—â–µ–Ω–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫

### 6. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**

1. **–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª** –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
2. **–ù–∞–∂–º–∏—Ç–µ `‚åò`** - —Ä–µ–¥–∞–∫—Ç–æ—Ä –∑–∞–º–µ–Ω–∏—Ç—Å—è —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–º
3. **–ù–∞–∂–º–∏—Ç–µ `üìù`** - –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä—É
4. **–¢–µ—Ä–º–∏–Ω–∞–ª –æ—Ç–∫—Ä–æ–µ—Ç—Å—è** –≤ –∫–∞—Ç–∞–ª–æ–≥–µ —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞
5. **–ü—Ä–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–∏ –ø–∞–Ω–µ–ª–µ–π** - –∫–∞–∂–¥–∞—è –ø–∞–Ω–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**

- **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ in-place**: –¢–µ—Ä–º–∏–Ω–∞–ª –∑–∞–º–µ–Ω—è–µ—Ç —Ä–µ–¥–∞–∫—Ç–æ—Ä –≤ —Ç–æ–π –∂–µ –ø–∞–Ω–µ–ª–∏
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è**: –¢–µ—Ä–º–∏–Ω–∞–ª –Ω–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
- **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å**: –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (—Ä–µ–¥–∞–∫—Ç–æ—Ä –∏–ª–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª) –≤–∏–¥–∏–º –≤ –∫–∞–∂–¥—ã–π –º–æ–º–µ–Ω—Ç
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞**: "Terminal - dirname" –∏–ª–∏ –∏–º—è —Ñ–∞–π–ª–∞

### **–ú–µ—Ç–æ–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º**

```ruby
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
ensure_correct_display_state() 

# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
toggle_terminal()

# –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ
show_terminal(working_dir)
hide_terminal()
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏**

```ruby
def initialize
  # ... –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ...
  
  # –£–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ —Ç–µ—Ä–º–∏–Ω–∞–ª —Å–∫—Ä—ã—Ç –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  ensure_correct_display_state
end
``` 